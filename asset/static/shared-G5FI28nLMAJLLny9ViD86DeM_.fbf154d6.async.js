"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9864],{2808:function(le,j,t){t.d(j,{Z:function(){return E}});var I=t(97857),d=t.n(I),T=t(62370),h=t(51663),Z=t(67294),c=t(85893);function E(_){return(0,c.jsx)(T.Z,d()(d()({},_),{},{children:(0,c.jsx)(h.Z,{showText:function(x){return x.toHexString()},allowClear:!0,presets:[{label:"Color",colors:["#1677ff","#722ed1","#13c2c2","#52c41a","#eb2f96","#f5222d","#fa8c16","#fadb14","#fa541c","#2f54eb","#faad14","#a0d911","#000000","#5cdbd3","#b37feb","#b7eb8f","#61affe","#9254de","#36cfc9","#ff9c6e","#ff6f00","#ffc069","#28a745","#6610f2","#6f42c1","#007bff","#17a2b8","#20c997","#00cccc","#ff6666"]}]})}))}},85184:function(le,j,t){t.d(j,{Z:function(){return Me}});var I=t(15009),d=t.n(I),T=t(99289),h=t.n(T),Z=t(5574),c=t.n(Z),E=t(87662),_=t(67294),w=t(27166),x=t(55681),ie=t(83622),B=t(23345),ue=t(25593),_e=t(86250),O=t(84567),de=t(71230),z=t(15746),$=t(2487),ce=t(83062),fe=t(96074),Ee=t(38345),me=t(97269),N=t(62370),he=t(12122),pe=t(87740),ve=t(23430),Pe=t(3616),V=t(64389),m=t(36146),A=t(5251),H=t(80821),De=t(24963),Oe=t(4813),a=t(85893);function Me(){var p=new m.Uo("components.systemBasic"),ge=(0,_.useContext)(De.Z),G=ge.message,Ce=(0,_.useState)([]),J=c()(Ce,2),v=J[0],Q=J[1],Ue=(0,_.useState)(0),X=c()(Ue,2),P=X[0],Y=X[1],Re=(0,_.useState)(0),k=c()(Re,2),M=k[0],q=k[1],je=(0,_.useState)(0),ee=c()(je,2),g=ee[0],S=ee[1],Ie=(0,_.useState)(!1),te=c()(Ie,2),b=te[0],Te=te[1],xe=(0,_.useState)("panel"),ae=c()(xe,2),Be=ae[0],ne=ae[1],Ae=(0,_.useState)([]),re=c()(Ae,2),se=re[0],L=re[1],W=(0,_.useRef)(),D=(0,_.useRef)(),C=(0,_.useRef)(null),K=v.reduce(function(n,e){return n+e.used},0),y=P>0&&P>=M,U=y&&Be==="disk"?"disk":"panel",oe=U==="disk"?P:M;return(0,_.useEffect)(function(){var n;b&&((0,E.PW)().then(function(e){e&&e.data&&(e.data.pathUsage&&(Q(e.data.pathUsage),L(e.data.pathUsage.filter(function(r){return!["export/panel","temp"].includes(r.name)}).map(function(r){return r.path}))),e.data.diskUsage&&Y(e.data.diskUsage),e.data.panelUsage&&q(e.data.panelUsage))}),!((n=W.current)===null||n===void 0)&&n.reloadAndRest&&W.current.reloadAndRest())},[g,b]),(0,_.useEffect)(function(){if(!(!C.current||v.length===0)){var n=V.JE(C.current)||V.S1(C.current),e=function(s,u){var f=v.map(function(R){return{value:R.used,name:p.format("panelUsage.".concat(R.name)),usedSize:R.usedSize||"0B",percent:s>0?(R.used/s*100).toFixed(4):"0.00"}});if(s>K){var F=s-K;f.push({value:F,name:u,usedSize:(0,A.FI)(F),percent:(F/s*100).toFixed(4)})}return f},r=["\u9762\u677F\u89C6\u89D2"],o=[{name:"\u9762\u677F\u89C6\u89D2",type:"pie",radius:"80%",center:["55%","55%"],data:e(M,"\u5176\u4ED6\u9762\u677F\u6570\u636E"),emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:function(s){return"".concat(s.name,`
{size|`).concat(s.data.usedSize,"}")},rich:{size:{color:"#888",fontSize:12,lineHeight:18}}}}];y&&(r.push("\u786C\u76D8\u89C6\u89D2"),o.push({name:"\u786C\u76D8\u89C6\u89D2",type:"pie",radius:"50%",center:["55%","55%"],data:e(P,"\u5176\u4ED6\u786C\u76D8\u7A7A\u95F4"),emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:function(s){return"".concat(s.name,`
{size|`).concat(s.data.usedSize,"}")},rich:{size:{color:"#888",fontSize:12,lineHeight:18}}}})),n.setOption({tooltip:{trigger:"item",formatter:function(s){return"".concat(s.marker," <b>").concat(s.name,"</b><br/>\u5B9E\u9645\u5927\u5C0F: ").concat(s.data.usedSize,"<br/>\u89C6\u53E3\u5360\u6BD4: ").concat(s.data.percent,"%")}},legend:{orient:"vertical",top:"0",left:"1%",selectedMode:"single",data:r,selected:{\u9762\u677F\u89C6\u89D2:U==="panel",\u786C\u76D8\u89C6\u89D2:U==="disk"}},series:o},!0),n.off("legendselectchanged"),n.on("legendselectchanged",function(l){var s=Object.keys(l.selected).find(function(u){return l.selected[u]});ne(s==="\u786C\u76D8\u89C6\u89D2"?"disk":"panel")});var i=function(){return n==null?void 0:n.resize()};return window.addEventListener("resize",i),function(){return window.removeEventListener("resize",i)}}},[v,P,M,y,U,K]),(0,a.jsxs)(w.Z,{open:b,drawerProps:{width:Pe.R_,destroyOnHidden:!0},onOpenChange:function(e){e||(Q([]),Y(0),q(0),ne("panel"),L([])),Te(e)},title:"\u7528\u91CF\u4E0E\u5907\u4EFD",trigger:(0,a.jsx)(ie.ZP,{style:{width:150},children:"\u7528\u91CF\u4E0E\u5907\u4EFD"}),children:[(0,a.jsx)(Ee.Z,{title:(0,a.jsxs)(B.Z,{children:[(0,a.jsx)(he.Z,{}),(0,a.jsx)("span",{children:"\u7528\u91CF\u7EDF\u8BA1"})]}),bordered:!0,headerBordered:!0,extra:(0,a.jsxs)(B.Z,{children:[(0,a.jsx)(H.Z,{buttonProps:{type:"primary"},action:h()(d()().mark(function n(){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,E.wC)({backupPath:se});case 2:G.success(m.FD.format("finish")),S(g+1);case 4:case"end":return r.stop()}},n)})),children:"\u5F00\u59CB\u5907\u4EFD"}),(0,a.jsx)(H.Z,{buttonProps:{danger:!0,style:{width:150}},action:h()(d()().mark(function n(){var e,r;return d()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,E.$D)({enableNotice:(e=D.current)===null||e===void 0?void 0:e.getFieldValue("enableNotice"),enableTempFile:(r=D.current)===null||r===void 0?void 0:r.getFieldValue("enableTempFile")});case 2:G.success(m.FD.format("finish")),S(g+1);case 4:case"end":return i.stop()}},n)})),confirmProps:{onOpenChange:function(e,r){var o;e&&(!((o=D.current)===null||o===void 0)&&o.resetFields)&&D.current.resetFields()},description:(0,a.jsxs)(B.Z,{style:{minWidth:300},direction:"vertical",wrap:!0,children:[(0,a.jsx)(ue.Z.Text,{children:p.format("panelUsagePruneTip")}),(0,a.jsx)(me.A,{name:"createForm",formRef:D,layout:"inline",submitter:!1,children:(0,a.jsxs)(_e.Z,{vertical:!0,children:[(0,a.jsx)(N.Z,{initialValue:!0,name:"enableTempFile",valuePropName:"checked",children:(0,a.jsx)(O.Z,{children:p.format("panelUsagePruneEnableTempFile")})}),(0,a.jsx)(N.Z,{initialValue:!0,name:"enableNotice",valuePropName:"checked",children:(0,a.jsx)(O.Z,{defaultChecked:!0,children:p.format("panelUsagePruneEnableNotice")})})]})})]})},children:p.format("panelUsagePruneButton")})]}),children:(0,a.jsxs)(de.Z,{gutter:24,align:"middle",children:[(0,a.jsx)(z.Z,{span:12,children:v.length>0&&(0,a.jsx)("div",{ref:C,style:{height:320,width:"100%"}})}),(0,a.jsx)(z.Z,{span:12,children:(0,a.jsx)(O.Z.Group,{style:{width:"100%"},value:se,onChange:function(e){return L(e)},children:(0,a.jsx)($.Z,{grid:{gutter:30,column:2},dataSource:v,renderItem:function(e){return(0,a.jsx)($.Z.Item,{children:(0,a.jsxs)(O.Z,{value:e.path,style:{width:"100%"},children:[(0,a.jsx)("span",{style:{fontWeight:"500",width:"90px",display:"inline-block"},children:(0,a.jsx)(ce.Z,{title:e.path,children:p.format("panelUsage."+e.name)})}),(0,a.jsxs)("span",{style:{color:"#1677ff"},children:[e.usedSize," / ",oe>0?(e.used/oe*100).toFixed(2):"0.00","%"]})]})})}})})})]})},"usage"),(0,a.jsx)(fe.Z,{variant:"dotted"}),(0,a.jsx)(x.Co,{ghost:!0,actionRef:W,search:!1,rowKey:"path",actions:[{key:"upload",label:"\u4E0A\u4F20\u5907\u4EFD\u6587\u4EF6",showInQuickToolbar:!0,buttonProps:{type:"primary"}},{key:"restore",label:m.FD.format("listManageUnpause"),showInOperator:!0,showInContext:"manage",buttonProps:{icon:(0,a.jsx)(pe.Z,{})}},{key:"download",label:m.FD.format("listManageDownload"),showInOperator:!0,showInContext:"manage",buttonProps:{icon:(0,a.jsx)(ve.Z,{})},action:function(e){return h()(d()().mark(function r(){var o,i,l,s;return d()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=e.loading,i=e.finish,l=e.selectedRow,o(),f.next=4,(0,E.w4)({name:l.path}).finally(function(){i(!0)});case 4:s=f.sent,s.data.downloadUrl&&(0,Oe.u)({url:s.data.downloadUrl});case 6:case"end":return f.stop()}},r)}))()}},{key:"delete",showInContext:!0,action:function(e){return h()(d()().mark(function r(){var o,i,l;return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return o=e.loading,i=e.finish,l=e.selectedRows,o(),u.abrupt("return",(0,E.Ug)({name:l.map(function(f){return f.path})}).finally(function(){i(!0),S(g+1)}));case 3:case"end":return u.stop()}},r)}))()}}],columns:[{title:m.FD.format("listFilePath"),dataIndex:"path"},{title:m.FD.format("listSize"),dataIndex:"size",render:function(e,r,o,i){return(0,A.FI)(r.size)}},{title:m.FD.format("listCreatedAt"),dataIndex:"createdAt",render:function(e,r,o,i){return(0,A.NF)(r.createdAt)}}],request:function(){var n=h()(d()().mark(function e(r,o,i){var l;return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,E.ip)();case 2:return l=u.sent,u.abrupt("return",{data:l.data.list,success:!0,total:l.data.list.length});case 4:case"end":return u.stop()}},e)}));return function(e,r,o){return n.apply(this,arguments)}}()},"backupFileList")]})}}}]);
